<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Line Chart</title>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <style type="text/css">
      .axis text{
          font-family:sans-serif;
          font-size:11px;
      }
      .axis path,
      .axis line{
        fill:none;
        stroke:gray;
        shape-rendering: crisp-edges;
      }
	  .legend rect {
		fill:white;
		stroke:black;
		opacity:0.8;}
</style>

<script src = "d3.legend.js"></script>

  </head>
<body>

<script>

var width = 800, height = 800;

var margins = {top:0, bottom: 120, left: 50, right:0};
var chartWidth = width - margins.left - margins.right;
var chartHeight = height - margins.top - margins.bottom;

var xScale = d3.scale.linear().range([0, chartWidth]);
var yScale = d3.scale.linear().range([chartHeight, 0]);
var colorScale = d3.scale.category10();

d3.csv("http://www.cs.middlebury.edu/~candrews/classes/infovis/data/orange.csv", function(dataset){

xScale.domain([0, d3.max(dataset, function(d){return +d.age;}) + 300]);
yScale.domain([0, d3.max(dataset, function(d){return +d.circumference}) + 20]);

var svg = d3.select('body')
	.append('svg')
	.attr({width: width, height: height});

var chart = svg.append('g')
	.attr("transform","translate("+margins.left + "," + margins.top + ")");

var nestedData = d3.nest()
	.key(function(d){return d.Tree})
	.entries(dataset);

console.log(" the following is ");
console.log(nestedData);

//Create the lines
var lineGenerator = d3.svg.line()
	.x(function(d){return margins.left + xScale(+d.age)})
	.y(function(d){return margins.top + yScale(+d.circumference)})
	.interpolate("linear");

	nestedData.forEach(function(entry, index){
		//console.log("entries");
		//console.log(entry.values);
	//Add lines
	chart.append("path")
	.datum(entry.values)
	.attr("class", "line")
	.attr("d", lineGenerator(entry.values))
	.attr("stroke", colorScale(index))
	.attr("stroke-width", 2)
	.attr("fill", "none")
	.attr('data-legend', "Tree " + entry.key)
	.attr('data-legend-pos', +entry.key);

	//Add dots
	entry.values.forEach(function(dot){
		chart.append("circle")
		.attr('cx', margins.left + xScale(+dot.age))
		.attr('cy', +yScale(+dot.circumference))
		.attr('r', 3)
		.attr('fill', colorScale(index));
	});

});

var legend = chart.append('g')
	.attr("class","legend")
	.attr("transform","translate(" + margins.left + ", " + Number(chartHeight + 50) + ")")
	.style("font-size","15px")
	.attr("fill", "white")
	.call(d3.legend)
	.selectAll('text')
	.attr('fill', 'black');

var xAxis = d3.svg.axis()
	.scale(xScale)
	.orient('bottom');

chart.append('g')
	.attr({
	"class": 'axis',
	"transform": "translate(" + margins.left + ", " + chartHeight + ")"
	})
	.call(xAxis)
	.append('text')
	.attr({
		x: chartWidth/2,
		y: margins.bottom /2,
		"text-anchor":"middle"
	})
	.text('Age');


var yAxis = d3.svg.axis()
	.scale(yScale)
	.orient('left');

chart.append("g")
	.attr('class', 'axis')
	.attr('transform', "translate(" + margins.left + ", 0)")
	.call(yAxis)
	.append('text')
	.attr({
		x: -chartHeight / 2,
		y: -margins.left / 1.5,
		"text-anchor": "middle",
		"transform": "rotate(-90)"
	})
	.text("Circumference");



});




</script>


</body>

</html>